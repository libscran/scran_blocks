<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>scran_blocks: Blocking utilities for libscran</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">scran_blocks
   </div>
   <div id="projectbrief">Blocking utilities for libscran</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Blocking utilities for libscran </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a></p>
<p><img src="https://github.com/libscran/scran_blocks/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/libscran/scran_blocks/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/libscran/scran_blocks"><img src="https://codecov.io/gh/libscran/scran_blocks/graph/badge.svg?token=JWV0I4WJX2" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This repository contains utilities for blocked analyses for the other <a href="https://github.com/libscran"><b>libscran</b></a> repositories. Any uninteresting factor of variation (usually across the cells) can be used as a blocking factor, e.g., experimental batches, sample/patient of origin. In the presence of blocks, our general strategy is to perform the analysis within each block before combining our conclusions across blocks. This ensures that our results are not affected by the uninteresting differences between blocks.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Averaging vectors</h1>
<p>The <code><a class="el" href="namespacescran__blocks.html#a6fcb43b96a8b97c00cfaf3ae83df028d">scran_blocks::average_vectors()</a></code> function will compute the element-wise averages of any number of equi-length arrays. This is typically used to average statistics across blocks, where each array contains the statistics for a single block over all genes.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="scran__blocks_8hpp.html">scran_blocks/scran_blocks.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">std::vector&lt;double&gt; stat1 { 1, 2, 3, 4 };</div>
<div class="line">std::vector&lt;double&gt; stat2 { 5, 6, 7, 8 };</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Contains { 3, 4, 5, 6 }.</span></div>
<div class="line"><span class="keyword">auto</span> averaged = <a class="code hl_function" href="namespacescran__blocks.html#a6fcb43b96a8b97c00cfaf3ae83df028d">scran_blocks::average_vectors</a>(</div>
<div class="line">    stat1.size(), </div>
<div class="line">    { stat1.data(), stat2.data() }</div>
<div class="line">    <span class="comment">/* skip_nan = */</span> <span class="keyword">false</span></div>
<div class="line">);</div>
<div class="ttc" id="anamespacescran__blocks_html_a6fcb43b96a8b97c00cfaf3ae83df028d"><div class="ttname"><a href="namespacescran__blocks.html#a6fcb43b96a8b97c00cfaf3ae83df028d">scran_blocks::average_vectors</a></div><div class="ttdeci">void average_vectors(size_t n, std::vector&lt; Stat_ * &gt; in, Output_ *out, bool skip_nan)</div><div class="ttdef"><b>Definition</b> average_vectors.hpp:122</div></div>
<div class="ttc" id="ascran__blocks_8hpp_html"><div class="ttname"><a href="scran__blocks_8hpp.html">scran_blocks.hpp</a></div><div class="ttdoc">Blocking utilities for libscran.</div></div>
</div><!-- fragment --><p>If NaNs are present, they can be ignored:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> nan = std::numeric_limits&lt;double&gt;::quiet_NaN();</div>
<div class="line">std::vector&lt;double&gt; stat1n { 1, nan, 3, nan };</div>
<div class="line">std::vector&lt;double&gt; stat2n { 5, 6, nan, nan };</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Contains { 3, 6, 3, nan }.</span></div>
<div class="line"><span class="keyword">auto</span> averagedn = <a class="code hl_function" href="namespacescran__blocks.html#a6fcb43b96a8b97c00cfaf3ae83df028d">scran_blocks::average_vectors</a>(</div>
<div class="line">    stat1n.size(), </div>
<div class="line">    { stat1n.data(), stat2n.data() }</div>
<div class="line">    <span class="comment">/* skip_nan = */</span> <span class="keyword">true</span></div>
<div class="line">);</div>
</div><!-- fragment --><p>We also support per-vector weights:</p>
<div class="fragment"><div class="line">std::vector&lt;double&gt; stat1w { 1, 2, 3, 4 };</div>
<div class="line">std::vector&lt;double&gt; stat2w { 5, 6, 7, 8 };</div>
<div class="line">std::vector&lt;double&gt; weights { 1, 9 };</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Contains { 4.6, 5.6, 6.6, 7.6 }.</span></div>
<div class="line"><span class="keyword">auto</span> averagedw = <a class="code hl_function" href="namespacescran__blocks.html#a18cca7404ce3514a7d1f55a747c489be">scran_blocks::average_vectors_weighted</a>(</div>
<div class="line">    stat1w.size(), </div>
<div class="line">    { stat1w.data(), stat2w.data() }</div>
<div class="line">    weights.data(),</div>
<div class="line">    <span class="comment">/* skip_nan = */</span> <span class="keyword">false</span></div>
<div class="line">);</div>
<div class="ttc" id="anamespacescran__blocks_html_a18cca7404ce3514a7d1f55a747c489be"><div class="ttname"><a href="namespacescran__blocks.html#a18cca7404ce3514a7d1f55a747c489be">scran_blocks::average_vectors_weighted</a></div><div class="ttdeci">void average_vectors_weighted(size_t n, std::vector&lt; Stat_ * &gt; in, const Weight_ *w, Output_ *out, bool skip_nan)</div><div class="ttdef"><b>Definition</b> average_vectors.hpp:164</div></div>
</div><!-- fragment --><p>See the <a href="https://libscran.github.io/scran_blocks">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Weighting blocks</h1>
<p>When combining statistics across blocks, it may be desirable to weight each block by its size, favoring larger blocks that can emit more stable statistics. This is done using the <code><a class="el" href="namespacescran__blocks.html#a8227c8eff7ef9f8172737478b5d41496">scran_blocks::compute_weights()</a></code> function that calculates a weight for each block based on its size.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="scran__blocks_8hpp.html">scran_blocks/scran_blocks.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">std::vector&lt;size_t&gt; block_sizes { 10, 100, 1000 };</div>
<div class="line"><span class="keyword">auto</span> weights = <a class="code hl_function" href="namespacescran__blocks.html#a8227c8eff7ef9f8172737478b5d41496">scran_blocks::compute_weights</a>(</div>
<div class="line">    block_sizes, </div>
<div class="line">    <span class="comment">/* policy = */</span> scran_blocks::WeightPolicy::VARIABLE,</div>
<div class="line">    <span class="comment">/* variable = */</span> { 0, 200 } </div>
<div class="line">);</div>
<div class="ttc" id="anamespacescran__blocks_html_a8227c8eff7ef9f8172737478b5d41496"><div class="ttname"><a href="namespacescran__blocks.html#a8227c8eff7ef9f8172737478b5d41496">scran_blocks::compute_weights</a></div><div class="ttdeci">void compute_weights(std::size_t num_blocks, const Size_ *sizes, WeightPolicy policy, const VariableWeightParameters &amp;variable, Weight_ *weights)</div><div class="ttdef"><b>Definition</b> block_weights.hpp:90</div></div>
</div><!-- fragment --><p>The above code chunk uses a variable block weight that increases linearly with block size from 0 to 200, after which it is capped at 1. This <code>VARIABLE</code> policy penalizes very small blocks to ensure that their unstable statistics do not overly influence the average. Blocks are equally weighted once they are "large enough", ensuring that the average is not dominated by a single very large block.</p>
<p>Users can also change the policy to <code>NONE</code>, where weights are equal to the block size; or <code>EQUAL</code>, where all blocks are equally weighted regardless of size (assuming they are non-empty). In such cases, the <code>variable</code> argument is ignored. Check out the <a href="https://libscran.github.io/scran_blocks">reference documentation</a> for more details.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Building projects</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
CMake with <code>FetchContent</code></h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  scran_blocks</div>
<div class="line">  GIT_REPOSITORY https://github.com/libscran/scran_blocks</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(scran_blocks)</div>
</div><!-- fragment --><p>Then you can link to <b><a class="el" href="namespacescran__blocks.html" title="Blocking utilities for libscran.">scran_blocks</a></b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe libscran::scran_blocks)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::scran_blocks)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
CMake with <code>find_package()</code></h2>
<div class="fragment"><div class="line">find_package(libscran_scran_blocks CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE libscran::scran_blocks)</div>
</div><!-- fragment --><p>To install the library, use:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DSCRAN_BLOCKS_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files in <code>include/</code> - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
