<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>scran_core_utils: Utilities for scran</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">scran_core_utils
   </div>
   <div id="projectbrief">Core utilities for libscran</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Utilities for scran </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a> <img src="https://github.com/libscran/core_utils/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/libscran/core_utils/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/libscran/core_utils"><img src="https://codecov.io/gh/libscran/core_utils/graph/badge.svg?token=JWV0I4WJX2" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This repository contains utility functions for the other <a href="https://github.com/libscran"><b>libscran</b></a> repositories. I don't know what else to say - it's just a mishmash of random functions that are re-used in multiple other libraries or don't warrant their own repository. Developers should check out the <a href="https://libscran.github.io/core_utils">reference documentation</a> for the available functions.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Averaging vectors</h1>
<p>The <code>average_vectors::compute()</code> function will compute the element-wise averages of any number of equi-length arrays.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="average__vectors_8hpp.html">scran/average_vectors.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">std::vector&lt;double&gt; stat1 { 1, 2, 3, 4 };</div>
<div class="line">std::vector&lt;double&gt; stat2 { 5, 6, 7, 8 };</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Contains { 3, 4, 5, 6 }.</span></div>
<div class="line"><span class="keyword">auto</span> averaged = <a class="code hl_function" href="namespacescran_1_1average__vectors.html#a4e172bae14695de308541d81cc138ea0">scran::average_vectors::compute</a>(</div>
<div class="line">    stat1.size(), </div>
<div class="line">    { stat1.data(), stat2.data() }</div>
<div class="line">    <span class="comment">/* skip_nan = */</span> <span class="keyword">false</span></div>
<div class="line">);</div>
<div class="ttc" id="aaverage__vectors_8hpp_html"><div class="ttname"><a href="average__vectors_8hpp.html">average_vectors.hpp</a></div><div class="ttdoc">Average parallel elements across vectors.</div></div>
<div class="ttc" id="anamespacescran_1_1average__vectors_html_a4e172bae14695de308541d81cc138ea0"><div class="ttname"><a href="namespacescran_1_1average__vectors.html#a4e172bae14695de308541d81cc138ea0">scran::average_vectors::compute</a></div><div class="ttdeci">void compute(size_t n, std::vector&lt; Stat_ * &gt; in, Output_ *out, bool skip_nan)</div><div class="ttdef"><b>Definition</b> average_vectors.hpp:127</div></div>
</div><!-- fragment --><p>If NaNs are present, they can be ignored:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="average__vectors_8hpp.html">scran/average_vectors.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> nan = std::numeric_limits&lt;double&gt;::quiet_NaN();</div>
<div class="line">std::vector&lt;double&gt; stat1 { 1, nan, 3, nan };</div>
<div class="line">std::vector&lt;double&gt; stat2 { 5, 6, nan, nan };</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Contains { 3, 6, 3, nan }.</span></div>
<div class="line"><span class="keyword">auto</span> averaged = <a class="code hl_function" href="namespacescran_1_1average__vectors.html#a4e172bae14695de308541d81cc138ea0">scran::average_vectors::compute</a>(</div>
<div class="line">    stat1.size(), </div>
<div class="line">    { stat1.data(), stat2.data() }</div>
<div class="line">    <span class="comment">/* skip_nan = */</span> <span class="keyword">true</span></div>
<div class="line">);</div>
</div><!-- fragment --><p>We also support per-vector weights:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="average__vectors_8hpp.html">scran/average_vectors.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">std::vector&lt;double&gt; stat1 { 1, 2, 3, 4 };</div>
<div class="line">std::vector&lt;double&gt; stat2 { 5, 6, 7, 8 };</div>
<div class="line">std::vector&lt;double&gt; weights { 1, 9 };</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Contains { 4.6, 5.6, 6.6, 7.6 }.</span></div>
<div class="line"><span class="keyword">auto</span> averaged = <a class="code hl_function" href="namespacescran_1_1average__vectors.html#a4e172bae14695de308541d81cc138ea0">scran::average_vectors::compute</a>(</div>
<div class="line">    stat1.size(), </div>
<div class="line">    { stat1.data(), stat2.data() }</div>
<div class="line">    weights.data(),</div>
<div class="line">    <span class="comment">/* skip_nan = */</span> <span class="keyword">false</span></div>
<div class="line">);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
Weighting blocks</h1>
<p>Several <b>libscran</b> analysis steps allow users to block on uninteresting factors like the batch or sample of origin. Statistics are typically computed within each block and then combined across each block (e.g., with <code>average_vectors::compute()</code>). When doing so, it may be desirable to weight each block by its size, favoring larger blocks that can emit more stable statistics.</p>
<p>The <code>block_weights::compute()</code> function will compute weights for each block based on its size. The example below uses a variable block weight that increases linearly with block size from 0 to 200, after which it is capped at 1. This <code>VARIABLE</code> policy penalizes very small blocks to ensure that their unstable statistics do not overly influence the average. However, blocks are equally weighted once they are "large enough", ensuring that the average is not dominated by a single very large block.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="block__weights_8hpp.html">scran/block_weights.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line">std::vector&lt;size_t&gt; block_sizes { 10, 100, 1000 };</div>
<div class="line"><span class="keyword">auto</span> weights = <a class="code hl_function" href="namespacescran_1_1block__weights.html#a1a9e797af79dad83d063605d50b7099e">scran::block_weights::compute</a>(</div>
<div class="line">    block_sizes, </div>
<div class="line">    <span class="comment">/* policy = */</span> scran::block_weights::VARIABLE,</div>
<div class="line">    <span class="comment">/* variable = */</span> { 0, 200 } </div>
<div class="line">);</div>
<div class="ttc" id="ablock__weights_8hpp_html"><div class="ttname"><a href="block__weights_8hpp.html">block_weights.hpp</a></div><div class="ttdoc">Calculation of per-block weights.</div></div>
<div class="ttc" id="anamespacescran_1_1block__weights_html_a1a9e797af79dad83d063605d50b7099e"><div class="ttname"><a href="namespacescran_1_1block__weights.html#a1a9e797af79dad83d063605d50b7099e">scran::block_weights::compute</a></div><div class="ttdeci">std::vector&lt; double &gt; compute(const std::vector&lt; Size_ &gt; &amp;sizes, Policy policy, const VariableParameters &amp;variable)</div><div class="ttdef"><b>Definition</b> block_weights.hpp:88</div></div>
</div><!-- fragment --><p>Users can also change the policy to <code>NONE</code>, where weights are equal to the block size; or <code>EQUAL</code>, where all blocks are equally weighted regardless of size (assuming they are non-empty).</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Building projects</h1>
<p>This repository is part of the broader <a href="https://github.com/libscran/libscran"><b>libscran</b></a> library, so users are recommended to use the latter in their projects. <b>libscran</b> developers should just use CMake with <code>FetchContent</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  scran_core_utils </div>
<div class="line">  GIT_REPOSITORY https://github.com/libscran/core_utils</div>
<div class="line">  GIT_TAG master # or any version of interest</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(scran_core_utils)</div>
<div class="line"> </div>
<div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe scran_core_utils)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE scran_core_utils)</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
